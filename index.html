<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Training App</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/scripts.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" href="icons/icon-192x192.png" sizes="192x192">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <!-- Toolbar -->
    <div class="status-bar">
        <div>Training App</div>
        <button id="loadJsonButton" class="load-json-button hidden">
            <i class="fas fa-cog"></i>
        </button>
    </div>

    <!-- Login -->
    <div id="loginContainer" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h1>Training App</h1>
                <p>Inicia sesión para continuar</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <input type="text" id="username" placeholder="Usuario" required>
                </div>
                <div class="form-group">
                    <input type="password" id="password" placeholder="Contraseña" required>
                </div>
                <button type="submit">Iniciar Sesión</button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="appContainer" class="container" style="display: none;">
        <div class="grid-container">
            <!-- Calendar -->
            <div class="card">
                <div class="calendar-header">
                    <button onclick="prevMonth()">&#9664;</button>
                    <h2 id="calendarMonth">Enero 2025</h2>
                    <button onclick="nextMonth()">&#9654;</button>
                </div>
                <div class="calendar-weekdays">
                    <div>Lun</div>
                    <div>Mar</div>
                    <div>Mié</div>
                    <div>Jue</div>
                    <div>Vie</div>
                    <div>Sáb</div>
                    <div>Dom</div>
                </div>
                <div id="calendar" class="calendar">
                    <!-- Calendar days will be generated here -->
                </div>
            </div>

            <!-- Training List -->
            <div class="card">
                <h2>Entrenamientos</h2>
                <div id="trainingList" class="training-list">
                    <!-- Training items will be generated here -->
                </div>
            </div>
        </div>

        <!-- Floating Add Button -->
        <div class="add-button" onclick="openModal()">+</div>
    </div>

    <!-- Modal -->
    <div id="addTrainingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Nuevo Entrenamiento</h3>
                <div class="close" onclick="closeModal()">✕</div>
            </div>
            <form id="addTrainingForm">
                <div class="form-group">
                    <input type="text" id="trainingTitle" placeholder="Título" required>
                </div>
                <div class="form-group">
                    <input type="date" id="trainingDate" required>
                </div>
                <div class="form-group">
                    <select id="trainingType" required>
                        <!-- Las opciones se generarán dinámicamente -->
                    </select>
                </div>
                <div class="form-group">
                    <textarea id="trainingDescription" placeholder="Descripción" rows="3"></textarea>
                </div>
                <button type="submit">Añadir Entrenamiento</button>
            </form>
        </div>
    </div>

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
            .then(function(registration) {
                console.log('Service Worker registrado con éxito:', registration);

                registration.onupdatefound = function() {
                    const installingWorker = registration.installing;
                    installingWorker.onstatechange = function() {
                        if (installingWorker.state === 'installed') {
                            if (navigator.serviceWorker.controller) {
                                // Nuevo contenido disponible; notifica al usuario
                                const updateNotification = document.createElement('div');
                                updateNotification.className = 'update-notification';
                                updateNotification.innerHTML = `
                                    <p>Hay una nueva versión disponible.</p>
                                    <button onclick="window.location.reload()">Actualizar</button>
                                `;
                                document.body.appendChild(updateNotification);
                            }
                        }
                    };
                };
            })
            .catch(function(error) {
                console.log('Error al registrar el Service Worker:', error);
            });
        }
    </script>
</body>
</html>